{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/app/mission/unassigned/PageClient.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/mission/unassigned/PageClient.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/mission/unassigned/PageClient.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAyS,GACtU,uEACA"}},
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/app/mission/unassigned/PageClient.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/mission/unassigned/PageClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/mission/unassigned/PageClient.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAqR,GAClT,mDACA"}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/util/api/fetchData.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\r\nexport default async function (\r\n  url: string,\r\n  refreshToken: string,\r\n  maxRetries = 3,\r\n  delay = 1000 // initial delay in ms\r\n): Promise<any | null> {\r\n  const requestOptions: RequestInit = {\r\n    method: \"GET\",\r\n    headers: {\r\n      Cookie: `oauth-abw_church_account_id=3619012236345409;oauth-abw_refresh_token=${refreshToken}`,\r\n    },\r\n    redirect: \"follow\",\r\n  };\r\n\r\n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\r\n    try {\r\n      const response = await fetch(url, requestOptions);\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Fetch failed: ${url}, Status: ${response.status}`);\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error(`Attempt ${attempt + 1} failed:`, error);\r\n\r\n      if (attempt < maxRetries) {\r\n        await new Promise((res) => setTimeout(res, delay * Math.pow(2, attempt))); // exponential backoff\r\n      } else {\r\n        console.error(\"All retry attempts failed.\");\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,qDAAqD;;;AACtC,8CACb,GAAW,EACX,YAAoB,EACpB,aAAa,CAAC,EACd,QAAQ,KAAK,sBAAsB;AAAvB;IAEZ,MAAM,iBAA8B;QAClC,QAAQ;QACR,SAAS;YACP,QAAQ,CAAC,qEAAqE,EAAE,cAAc;QAChG;QACA,UAAU;IACZ;IAEA,IAAK,IAAI,UAAU,GAAG,WAAW,YAAY,UAAW;QACtD,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,KAAK;YAElC,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM,CAAC,cAAc,EAAE,IAAI,UAAU,EAAE,SAAS,MAAM,EAAE;YACpE;YAEA,OAAO,MAAM,SAAS,IAAI;QAC5B,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,CAAC,QAAQ,EAAE,UAAU,EAAE,QAAQ,CAAC,EAAE;YAEhD,IAAI,UAAU,YAAY;gBACxB,MAAM,IAAI,QAAQ,CAAC,MAAQ,WAAW,KAAK,QAAQ,KAAK,GAAG,CAAC,GAAG,YAAY,sBAAsB;YACnG,OAAO;gBACL,QAAQ,KAAK,CAAC;gBACd,OAAO;YACT;QACF;IACF;AACF"}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/util/filterUniqueEvent.ts"],"sourcesContent":["import { ContactAttempt } from \"@/interfaces\";\r\n\r\nexport default (events: ContactAttempt[]) => {\r\n  const eventDays = new Set();\r\n  return events.filter(({ itemDate }) => {\r\n    const date = new Date(itemDate - 3 * 60 * 60 * 1000);\r\n    const dayKey = date.toISOString().split(\"T\")[0]; // Gets YYYY-MM-DD in UTC\r\n    if (eventDays.has(dayKey)) return false;\r\n    eventDays.add(dayKey);\r\n    return true;\r\n  });\r\n};\r\n"],"names":[],"mappings":";;;uCAEe,CAAC;IACd,MAAM,YAAY,IAAI;IACtB,OAAO,OAAO,MAAM,CAAC,CAAC,EAAE,QAAQ,EAAE;QAChC,MAAM,OAAO,IAAI,KAAK,WAAW,IAAI,KAAK,KAAK;QAC/C,MAAM,SAAS,KAAK,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,yBAAyB;QAC1E,IAAI,UAAU,GAAG,CAAC,SAAS,OAAO;QAClC,UAAU,GAAG,CAAC;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/app/mission/unassigned/api/getReferrals.ts"],"sourcesContent":["import { AreaInfo, ContactAttempt, Referral } from \"@/interfaces\";\r\nimport fetchData from \"@/util/api/fetchData\";\r\nimport filterUniqueEvent from \"@/util/filterUniqueEvent\";\r\nimport pLimit from \"p-limit\";\r\n\r\nconst limit = pLimit(3);\r\n\r\nasync function fetchAreaInfo(referrals: Referral[], refreshToken: string) {\r\n  return Promise.all(\r\n    referrals.map(async (ref) => {\r\n      const url = `https://referralmanager.churchofjesuschrist.org/services/mission/assignment?address=${ref.address}`;\r\n      const areaInfo: AreaInfo = await fetchData(url, refreshToken);\r\n      return { ...ref, areaInfo };\r\n    })\r\n  );\r\n}\r\n\r\nasync function fetchEvents(referrals: Referral[], refreshToken: string) {\r\n  return Promise.all(\r\n    referrals.map(async (ref) => {\r\n      const contactAttempts: ContactAttempt[] = await fetchData(\r\n        `https://referralmanager.churchofjesuschrist.org/services/progress/timeline/${ref.personGuid}`,\r\n        refreshToken\r\n      );\r\n      if (contactAttempts) {\r\n        const filteredAttempts = filterUniqueEvent(contactAttempts.filter(({ timelineItemType }) => [\"CONTACT\", \"TEACHING\"].includes(timelineItemType)));\r\n        return { ...ref, contactAttempts: filteredAttempts };\r\n      }\r\n      return { ...ref, contactAttempts: [] };\r\n    })\r\n  );\r\n}\r\n\r\nexport async function loadReferralDetails(referrals: Referral[], refreshToken: string) {\r\n  const withArea = await fetchAreaInfo(referrals, refreshToken);\r\n  const withEvents = await fetchEvents(withArea, refreshToken);\r\n  return withEvents;\r\n}\r\n\r\nexport async function getReferrals(refreshToken: string) {\r\n  const missionId = process.env.NEXT_PUBLIC_MISSION_ID;\r\n  const url = `https://referralmanager.churchofjesuschrist.org/services/people/mission/${missionId}`;\r\n  const data = await fetchData(url, refreshToken);\r\n  if (!data) return [];\r\n  const persons: Referral[] = data.persons;\r\n  const filtered = persons.filter((ref) => !ref.areaId && ref.personStatusId === 1);\r\n  filtered.sort((a, b) => new Date(b.createDate).getTime() - new Date(a.createDate).getTime());\r\n\r\n  return filtered;\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAEA,MAAM,QAAQ,CAAA,GAAA,mIAAA,CAAA,UAAM,AAAD,EAAE;AAErB,eAAe,cAAc,SAAqB,EAAE,YAAoB;IACtE,OAAO,QAAQ,GAAG,CAChB,UAAU,GAAG,CAAC,OAAO;QACnB,MAAM,MAAM,CAAC,oFAAoF,EAAE,IAAI,OAAO,EAAE;QAChH,MAAM,WAAqB,MAAM,CAAA,GAAA,wHAAA,CAAA,UAAS,AAAD,EAAE,KAAK;QAChD,OAAO;YAAE,GAAG,GAAG;YAAE;QAAS;IAC5B;AAEJ;AAEA,eAAe,YAAY,SAAqB,EAAE,YAAoB;IACpE,OAAO,QAAQ,GAAG,CAChB,UAAU,GAAG,CAAC,OAAO;QACnB,MAAM,kBAAoC,MAAM,CAAA,GAAA,wHAAA,CAAA,UAAS,AAAD,EACtD,CAAC,2EAA2E,EAAE,IAAI,UAAU,EAAE,EAC9F;QAEF,IAAI,iBAAiB;YACnB,MAAM,mBAAmB,CAAA,GAAA,yHAAA,CAAA,UAAiB,AAAD,EAAE,gBAAgB,MAAM,CAAC,CAAC,EAAE,gBAAgB,EAAE,GAAK;oBAAC;oBAAW;iBAAW,CAAC,QAAQ,CAAC;YAC7H,OAAO;gBAAE,GAAG,GAAG;gBAAE,iBAAiB;YAAiB;QACrD;QACA,OAAO;YAAE,GAAG,GAAG;YAAE,iBAAiB,EAAE;QAAC;IACvC;AAEJ;AAEO,eAAe,oBAAoB,SAAqB,EAAE,YAAoB;IACnF,MAAM,WAAW,MAAM,cAAc,WAAW;IAChD,MAAM,aAAa,MAAM,YAAY,UAAU;IAC/C,OAAO;AACT;AAEO,eAAe,aAAa,YAAoB;IACrD,MAAM;IACN,MAAM,MAAM,CAAC,wEAAwE,EAAE,WAAW;IAClG,MAAM,OAAO,MAAM,CAAA,GAAA,wHAAA,CAAA,UAAS,AAAD,EAAE,KAAK;IAClC,IAAI,CAAC,MAAM,OAAO,EAAE;IACpB,MAAM,UAAsB,KAAK,OAAO;IACxC,MAAM,WAAW,QAAQ,MAAM,CAAC,CAAC,MAAQ,CAAC,IAAI,MAAM,IAAI,IAAI,cAAc,KAAK;IAC/E,SAAS,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,UAAU,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,UAAU,EAAE,OAAO;IAEzF,OAAO;AACT"}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 169, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/util/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nexport const prisma = new PrismaClient();\r\n"],"names":[],"mappings":";;;AAAA;;AAEO,MAAM,SAAS,IAAI,6HAAA,CAAA,eAAY"}},
    {"offset": {"line": 175, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 181, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/app/mission/unassigned/api/getUsers.ts"],"sourcesContent":["import { prisma } from \"@/util/db\";\r\n\r\nexport default async function getUsers() {\r\n  try {\r\n    const users = await prisma.user.findMany();\r\n    return users;\r\n  } catch (error) {\r\n    console.error(error);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;;AAEe,eAAe;IAC5B,IAAI;QACF,MAAM,QAAQ,MAAM,0GAAA,CAAA,SAAM,CAAC,IAAI,CAAC,QAAQ;QACxC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,EAAE;IACX;AACF"}},
    {"offset": {"line": 195, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/app/mission/unassigned/api/getAreas.ts"],"sourcesContent":["import { prisma } from \"@/util/db\";\r\n\r\nexport default async function getAreas() {\r\n  try {\r\n    const areas = await prisma.area.findMany({\r\n      where: {\r\n        is_active: true,\r\n      },\r\n      orderBy: {\r\n        name: \"asc\",\r\n      },\r\n    });\r\n    return areas;\r\n  } catch (error) {\r\n    console.error(error);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;;AAEe,eAAe;IAC5B,IAAI;QACF,MAAM,QAAQ,MAAM,0GAAA,CAAA,SAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;YACvC,OAAO;gBACL,WAAW;YACb;YACA,SAAS;gBACP,MAAM;YACR;QACF;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,EAAE;IACX;AACF"}},
    {"offset": {"line": 222, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/app/mission/unassigned/api/getUba.ts"],"sourcesContent":["import { prisma } from \"@/util/db\";\r\n\r\nexport default async function getUba() {\r\n  try {\r\n    const uba = await prisma.uba_area.findMany({ orderBy: { name: \"asc\" } });\r\n    return uba;\r\n  } catch (error) {\r\n    console.error(error);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;;AAEe,eAAe;IAC5B,IAAI;QACF,MAAM,MAAM,MAAM,0GAAA,CAAA,SAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAAE,SAAS;gBAAE,MAAM;YAAM;QAAE;QACtE,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,EAAE;IACX;AACF"}},
    {"offset": {"line": 246, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 252, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/app/mission/unassigned/api/getOffers.ts"],"sourcesContent":["import { prisma } from \"@/util/db\";\r\n\r\nexport default async function getOffers() {\r\n  try {\r\n    const offers = await prisma.offer.findMany({ orderBy: { name: \"asc\" } });\r\n    return offers;\r\n  } catch (error) {\r\n    console.error(error);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;;AAEe,eAAe;IAC5B,IAAI;QACF,MAAM,SAAS,MAAM,0GAAA,CAAA,SAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;YAAE,SAAS;gBAAE,MAAM;YAAM;QAAE;QACtE,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,EAAE;IACX;AACF"}},
    {"offset": {"line": 270, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 276, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/app/mission/unassigned/api/getStopReasons.ts"],"sourcesContent":["import { prisma } from \"@/util/db\";\r\n\r\nexport default async function getStopReasons() {\r\n  try {\r\n    const reasons = await prisma.stop_teaching_reason.findMany({ orderBy: { name: \"asc\" } });\r\n    return reasons;\r\n  } catch (error) {\r\n    console.error(error);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;;AAEe,eAAe;IAC5B,IAAI;QACF,MAAM,UAAU,MAAM,0GAAA,CAAA,SAAM,CAAC,oBAAoB,CAAC,QAAQ,CAAC;YAAE,SAAS;gBAAE,MAAM;YAAM;QAAE;QACtF,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,EAAE;IACX;AACF"}},
    {"offset": {"line": 294, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Escritorio/Desktop/brazil_curitiba_referralmanager/app/mission/unassigned/page.tsx"],"sourcesContent":["// Components\r\nimport PageClient from \"./PageClient\";\r\n\r\n// Server APIS\r\nimport { getReferrals } from \"./api/getReferrals\";\r\nimport getUsers from \"./api/getUsers\";\r\nimport getAreas from \"./api/getAreas\";\r\nimport getUba from \"./api/getUba\";\r\nimport getOffers from \"./api/getOffers\";\r\nimport getStopReasons from \"./api/getStopReasons\";\r\n\r\n// External APIS\r\nimport { redirect } from \"next/navigation\";\r\n\r\nexport default async function Page({ searchParams }: { searchParams: Promise<{ refreshToken?: string }> }) {\r\n  const { refreshToken } = await searchParams;\r\n  if (!refreshToken) {\r\n    redirect(\"/\");\r\n  }\r\n\r\n  const [referrals, users, areas, uba, offers, stopReasons] = await Promise.all([\r\n    getReferrals(refreshToken),\r\n    getUsers(),\r\n    getAreas(),\r\n    getUba(),\r\n    getOffers(),\r\n    getStopReasons(),\r\n  ]);\r\n\r\n  return (\r\n    <PageClient areas={areas} offers={offers} referrals={referrals} stopTeachingReasons={stopReasons} uba={uba} users={users} refreshToken={refreshToken} />\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,aAAa;;;;;AACb;AAEA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AAEA,gBAAgB;AAChB;AAAA;;;;;;;;;;AAEe,eAAe,KAAK,EAAE,YAAY,EAAwD;IACvG,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM;IAC/B,IAAI,CAAC,cAAc;QACjB,CAAA,GAAA,qLAAA,CAAA,WAAQ,AAAD,EAAE;IACX;IAEA,MAAM,CAAC,WAAW,OAAO,OAAO,KAAK,QAAQ,YAAY,GAAG,MAAM,QAAQ,GAAG,CAAC;QAC5E,CAAA,GAAA,mJAAA,CAAA,eAAY,AAAD,EAAE;QACb,CAAA,GAAA,+IAAA,CAAA,UAAQ,AAAD;QACP,CAAA,GAAA,+IAAA,CAAA,UAAQ,AAAD;QACP,CAAA,GAAA,6IAAA,CAAA,UAAM,AAAD;QACL,CAAA,GAAA,gJAAA,CAAA,UAAS,AAAD;QACR,CAAA,GAAA,qJAAA,CAAA,UAAc,AAAD;KACd;IAED,qBACE,8OAAC,2IAAA,CAAA,UAAU;QAAC,OAAO;QAAO,QAAQ;QAAQ,WAAW;QAAW,qBAAqB;QAAa,KAAK;QAAK,OAAO;QAAO,cAAc;;;;;;AAE5I"}},
    {"offset": {"line": 352, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 363, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 363, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}